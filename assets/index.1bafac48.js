var te=Object.defineProperty;var F=Object.getOwnPropertySymbols;var ae=Object.prototype.hasOwnProperty,se=Object.prototype.propertyIsEnumerable;var P=(e,s,n)=>s in e?te(e,s,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[s]=n,N=(e,s)=>{for(var n in s||(s={}))ae.call(s,n)&&P(e,n,s[n]);if(F)for(var n of F(s))se.call(s,n)&&P(e,n,s[n]);return e};import{p as ie,S as re}from"./index.ab64c04b.js";import{S as le}from"./index.ca70982b.js";import{I as ce}from"./index.e289ac8a.js";import{p as ue,P as pe}from"./index.4ab1c0b7.js";import{p as B,c as me,a as M,t as L,q as de,r as he,g as ve,s as ge}from"./components.78cffb68.js";import{d as fe,a as v,e as we,w as Te,_ as Ce,l as k,f as I,p as X,N as Y,n as ye,h as U,ac as Se,E as g,D as $,H as Ie,F as ke,G as O,m as Ye,K as H,i as W,r as De,W as Ne}from"./vue-router.esm-bundler.c9213159.js";const Xe=N(N({show:{type:Boolean,default:!1},images:{type:Array,default:()=>[]},current:{type:String},zoom:{type:[String,Number],default:2},closeable:{type:Boolean,default:!1},"onUpdate:show":{type:Function}},B(ie,["loop","indicator","onChange"])),B(ue,["lockScroll","teleport","onOpen","onClose","onOpened","onClosed","onRouteChange"]));const{n:$e,classes:Oe}=me("image-preview"),q=12,G=200,Re=350,K=200,ze=fe({name:"VarImagePreview",components:{VarSwipe:re,VarSwipeItem:le,VarPopup:pe,VarIcon:ce},inheritAttrs:!1,props:Xe,setup(e){const s=v(!1),n=we(()=>{const{images:o,current:a}=e,t=o.findIndex(l=>l===a);return t>=0?t:0}),u=v(1),r=v(0),w=v(0),T=v(void 0),C=v(void 0),y=v(!0);let m=null,i=null,c=null;const R=(o,a)=>{const{clientX:t,clientY:l}=o,{clientX:p,clientY:d}=a;return Math.abs(Math.sqrt((p-t)**2+(d-l)**2))},z=(o,a)=>({clientX:o.clientX,clientY:o.clientY,timestamp:Date.now(),target:a}),Z=()=>{u.value=L(e.zoom),y.value=!1,i=null,window.setTimeout(()=>{T.value="linear",C.value="0s"},K)},V=()=>{u.value=1,r.value=0,w.value=0,y.value=!0,i=null,T.value=void 0,C.value=void 0},j=o=>i?R(i,o)<=q&&o.timestamp-i.timestamp<=G&&i.target===o.target:!1,J=o=>!o||!m||!i?!1:R(m,i)<=q&&Date.now()-i.timestamp<Re&&(o===m.target||o.parentNode===m.target),Q=o=>{c=window.setTimeout(()=>{J(o.target)&&E(),m=null},G)},_=o=>{c&&window.clearTimeout(c);const{touches:a}=o,t=z(a[0],o.currentTarget);if(m=t,j(t)){u.value>1?V():Z();return}i=t},A=o=>{const{offsetWidth:a,offsetHeight:t}=o,{naturalWidth:l,naturalHeight:p}=o.querySelector(".var-image-preview__image");return{width:a,height:t,imageRadio:p/l,rootRadio:t/a,zoom:L(e.zoom)}},x=o=>{const{zoom:a,imageRadio:t,rootRadio:l,width:p,height:d}=A(o);if(!t)return 0;const S=t>l?d/t:p;return Math.max(0,(a*S-p)/2)/a},ee=o=>{const{zoom:a,imageRadio:t,rootRadio:l,width:p,height:d}=A(o);if(!t)return 0;const S=t>l?d:p*t;return Math.max(0,(a*S-d)/2)/a},b=(o,a,t)=>o+a>=t?t:o+a<=-t?-t:o+a,oe=o=>{if(!i)return;const a=o.currentTarget,{touches:t}=o,l=z(t[0],a);if(u.value>1){const p=l.clientX-i.clientX,d=l.clientY-i.clientY,S=x(a),ne=ee(a);r.value=b(r.value,p,S),w.value=b(w.value,d,ne)}i=l},E=()=>{if(u.value>1){V(),setTimeout(()=>M(e["onUpdate:show"],!1),K);return}M(e["onUpdate:show"],!1)};return Te(()=>e.show,o=>{s.value=o},{immediate:!0}),{n:$e,classes:Oe,initialIndex:n,popupShow:s,scale:u,translateX:r,translateY:w,canSwipe:y,transitionTimingFunction:T,transitionDuration:C,handleTouchstart:_,handleTouchmove:oe,handleTouchend:Q,close:E}}}),Ve=["src","alt"];function Ae(e,s,n,u,r,w){const T=k("var-swipe-item"),C=k("var-swipe"),y=k("var-icon"),m=k("var-popup");return I(),X(m,{class:g(e.n("popup")),"var-image-preview-cover":"",transition:"var-fade",show:e.popupShow,overlay:!1,"close-on-click-overlay":!1,"lock-scroll":e.lockScroll,teleport:e.teleport,onOpen:e.onOpen,onClose:e.onClose,onClosed:e.onClosed,onOpened:e.onOpened,onRouteChange:e.onRouteChange},{default:Y(()=>[ye(C,Ye({class:e.n("swipe"),"var-image-preview-cover":"",touchable:e.canSwipe,indicator:e.indicator&&e.images.length>1,"initial-index":e.initialIndex,loop:e.loop,onChange:e.onChange},e.$attrs),{default:Y(()=>[(I(!0),U(ke,null,Se(e.images,i=>(I(),X(T,{class:g(e.n("swipe-item")),"var-image-preview-cover":"",key:i},{default:Y(()=>[$("div",{class:g(e.n("zoom-container")),style:Ie({transform:`scale(${e.scale}) translate(${e.translateX}px, ${e.translateY}px)`,transitionTimingFunction:e.transitionTimingFunction,transitionDuration:e.transitionDuration}),onTouchstart:s[0]||(s[0]=(...c)=>e.handleTouchstart&&e.handleTouchstart(...c)),onTouchmove:s[1]||(s[1]=(...c)=>e.handleTouchmove&&e.handleTouchmove(...c)),onTouchend:s[2]||(s[2]=(...c)=>e.handleTouchend&&e.handleTouchend(...c))},[$("img",{class:g(e.n("image")),src:i,alt:i},null,10,Ve)],38)]),_:2},1032,["class"]))),128))]),indicator:Y(({index:i,length:c})=>[O(e.$slots,"indicator",{index:i,length:c},()=>[e.indicator&&e.images.length>1?(I(),U("div",{key:0,class:g(e.n("indicators"))},H(i+1)+" / "+H(c),3)):W("v-if",!0)])]),_:3},16,["class","touchable","indicator","initial-index","loop","onChange"]),O(e.$slots,"close-icon",{},()=>[e.closeable?(I(),X(y,{key:0,class:g(e.n("close-icon")),name:"close-circle","var-image-preview-cover":"",onClick:e.close},null,8,["class","onClick"])):W("v-if",!0)]),$("div",{class:g(e.n("extra"))},[O(e.$slots,"extra")],2)]),_:3},8,["class","show","lock-scroll","teleport","onOpen","onClose","onClosed","onOpened","onRouteChange"])}var f=Ce(ze,[["render",Ae]]);let h;function D(e){if(!de())return;D.close();const s=ve(e)?{images:[e]}:ge(e)?{images:e}:e,n=De(s);n.teleport="body",h=n;const{unmountInstance:u}=he(f,n,{onClose:()=>{var r;return(r=n.onClose)==null?void 0:r.call(n)},onClosed:()=>{var r;(r=n.onClosed)==null||r.call(n),u(),h===n&&(h=null)},onRouteChange:()=>{u(),h===n&&(h=null)},"onUpdate:show":r=>{n.show=r}});n.show=!0}D.close=()=>{if(h!=null){const e=h;h=null,Ne().then(()=>{e.show=!1})}};f.install=function(e){e.component(f.name,f)};D.install=function(e){e.component(f.name,f)};D.Component=f;export{D as I};
